/*!
 * Local.js v1.2
 * (c) 2020 Nguyen Thanh
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Local=t()}(this,function(){"use strict";var local={},settings={},onEvents={},localStorage=window.localStorage||{},error=(window.console&&window.console.error||noop).bind(console),isarr=Array.isArray,arrayProto=Array.prototype,methodsWatch="push pop shift unshift splice sort reverse".split(" ");function noop(){}function def(e,t,o,n){Object.defineProperty(e,t,{value:o,enumerable:!!n,writable:!0,configurable:!0})}function isobj(e){return null!==e&&"object"==typeof e&&!isarr(e)}function on(e,t){return isarr(onEvents[e])||(onEvents[e]=[]),onEvents[e].push(t),this}function off(e,t){return t?onEvents[e].forEach(function(o,n){t===o&&delete onEvents[e][n]}):onEvents[e]=[],this}function once(e,t){return on(e,function o(){t.apply(this,arguments),off(e,o)}),this}function trigger(e,t){isarr(onEvents[e])&&onEvents[e].forEach(function(o){"function"==typeof o&&o.call(null,t,getValue(e))})}function ofType(e,t){return void 0===t||void 0===e||(isarr(t)?t:[t]).some(function(t){return null!==e&&e.constructor===t})}function defaultValue(e){var t;return isarr(e)||(e=[e]),e.some(function(e){return e==String?(t="",!0):e==Object?(t={},!0):e==Array?(t=[],!0):e==Boolean?(t=!1,!0):void 0}),void 0===t?new e[0]:t}function getValue(key){var val=localStorage[key],sett=settings[key];return void 0===sett?error('Local.js: "'+key+'" not sign!'):(void 0!==val?(val=JSON.parse(val),val=val.isJSON?val.value:val.isBoolean?eval(val.value):JSON.stringify(val.value),ofType(val,sett.type)||(val=defaultValue(sett.type))):val=defaultValue(sett.type),val)}function watchArray(e,t){Object.create(arrayProto);methodsWatch.forEach(function(o){var n=arrayProto[o];def(e,o,function(){n.apply(this,arguments),t.apply(this,arguments)})})}var keySys=["$on","$off","$watch","$one","$clear"];function resign(e,t){return Array.isArray(e)?e.forEach(function(e){resign(e,t)}):keySys.indexOf(e)>-1?error('Local.js: "'+e+'" is key sign watch. Do not use key use! You can omit the first $ character.'):(settings[e]=t||{},void Object.defineProperty(local,e,{set:function(t){if("function"==typeof t)return error("Local.js: localStorage don't data is function.");var o,n=settings[e],r=!1;void 0===t&&void 0!==n.default&&(t="function"==typeof n.default?n.default():n.default,r=!0),(o=ofType(t,n.type))||error("Local.js: "+(r?"Type value default left!":"Type value left!")),("function"!=typeof n.validator||n.validator(t,getValue(e))&&o)&&(t=JSON.stringify({value:t,isJSON:isobj(t)||isarr(t),isBoolean:"boolean"==typeof t}),localStorage[e]=t,trigger("set:"+e,JSON.parse(t).value)),ofType(getValue(e),n.type)||(local[e]=defaultValue(n.type))},get:function(){var t=getValue(e);return trigger("get:"+e,t),isarr(t)&&watchArray(t,function(){local[e]=this}),t}}))}function watch(e){if(isarr(e))resign(e);else for(var t in e)o=void 0,n=void 0,void 0!==(o=isobj(e[t])?e[t]:{type:e[t]}).type&&o.type==Function||isarr(o.type)&&isarr(o.type).indexOf(Function)>-1?error("Local.js: localStorage don't data is function."):(resign(t,o),void 0===getValue(t)&&("function"==typeof(n="function"==typeof o.default?o.default():o.default)?error("Local.js: localStorage don't data is function in default."):local[t]=n));var o,n;return this}function clear(e){if(void 0===e){for(var t in settings)local[t]=defaultValue(settings[t].type);return this}return isarr(e)||(e=[e]),e.forEach(function(e){if(!(e in settings))return error('Local.js: "'+e+'" not watch!');local[e]=defaultValue(settings[e].type)}),this}return local.$on=on,local.$off=off,local.$watch=watch,local.$one=once,local.$clear=clear,local});